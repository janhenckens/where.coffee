$(function(){$("#getlocation").on("click",function(){function success(position){console.log("Location found (2)");var $long=position.coords.longitude,$lat=position.coords.latitude;console.log("Longitude: "+$long),console.log("Latitude: "+$lat),$.ajax({url:"location",type:"post",datatype:"json",cache:"false",data:{latitude:$lat,longitude:$long},success:function(data){$(".container").fadeOut("slow"),$(".container").addClass("hidden");var locations=jQuery.parseJSON(data);if(console.log(locations.meta),"200"==locations.meta.code){console.log("Status OK"),console.log("Start drawing the map");var map=L.mapbox.map("map","http://a.tiles.mapbox.com/v3/examples.map-0l53fhk2.json",{zoom:15,center:[$lat,$long]}),myLayer=L.mapbox.featureLayer().addTo(map);$.each(locations.response.groups[0].items,function(){L.icon({title:this.venue.name});L.marker([this.venue.location.lat,this.venue.location.lng],{title:this.venue.name}).bindLabel(this.venue.name).addTo(myLayer)})}else console.log("Looks like foursquare is having issues, please try again later.")},error:function(xhr,desc,err){console.log(xhr),console.log("Details: "+desc+"\nError:"+err)}})}function error(position){console.log(position)}console.log("Button Pressed (1)"),$("#getlocation").attr("disabled","disabled"),navigator.geolocation?navigator.geolocation.getCurrentPosition(success,error):error("not supported")})});