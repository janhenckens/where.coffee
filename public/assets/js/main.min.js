$(document).ready(function(){$("#getlocation").on("click",function(){function success(position){console.log("Location found (2)");var $long=position.coords.longitude,$lat=position.coords.latitude;console.log("Longitude: "+$long),console.log("Latitude: "+$lat),$.ajax({url:"location",type:"post",datatype:"json",cache:"false",data:{latitude:$lat,longitude:$long}}).done(function(data){$(".container").fadeOut("slow"),$(".container").addClass("hidden");var locations=jQuery.parseJSON(data);if(console.log(locations.meta),console.log(locations),"200"==locations.meta.code){console.log("Status OK"),console.log("Start drawing the map"),map=L.mapbox.map("map","http://a.tiles.mapbox.com/v3/examples.map-0l53fhk2.json",{zoom:15,center:[$lat,$long]});{L.mapbox.featureLayer().addTo(map)}$.each(locations.response.groups[0].items,function(){var popupContent="<h1>"+this.venue.name+"</h1>";console.log(popupContent),L.marker([this.venue.location.lat,this.venue.location.lng],{title:this.venue.name}).addTo(map).bindPopup(popupContent)})}else console.log("Looks like foursquare is having issues, please try again later.")})}function error(position){console.log(position)}console.log("Button Pressed (1)"),$("#getlocation").attr("disabled","disabled"),navigator.geolocation?navigator.geolocation.getCurrentPosition(success,error):error("not supported")}),$("form").on("submit",function(e){e.preventDefault();var $location=$("input[name=searchlocation]").val();console.log($location),$.ajax({type:"post",url:"search",data:{location:$location},success:function(){console.log("form was submitted")}}).done(function(data){$(".container").fadeOut("slow"),$(".container").addClass("hidden");var locations=jQuery.parseJSON(data);if(console.log(locations),console.log(locations.response.geocode.center.lat),"200"==locations.meta.code){console.log("Status OK"),console.log("Start drawing the map");{var map=L.mapbox.map("map","http://a.tiles.mapbox.com/v3/examples.map-0l53fhk2.json",{zoom:15,center:[locations.response.geocode.center.lat,locations.response.geocode.center.lng]});L.mapbox.featureLayer().addTo(map)}$.each(locations.response.groups[0].items,function(){var popupContent="<h1>"+this.venue.name+"</h1>";console.log(popupContent),L.marker([this.venue.location.lat,this.venue.location.lng],{title:this.venue.name}).addTo(map).bindPopup(popupContent)})}else console.log("Looks like foursquare is having issues, please try again later.")})})});