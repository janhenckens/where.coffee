$(function(){$("#getlocation").on("click",function(){function success(position){console.log("Location found (2)");var $long=position.coords.longitude,$lat=position.coords.latitude;console.log("Longitude: "+$long),console.log("Latitude: "+$lat),$.post("location/",{longitude:$long,latitude:$lat},function(json){var locations=jQuery.parseJSON(json);if("200"==locations.meta.code){console.log("Status OK"),console.log(locations),console.log("Start drawing the map");var map=L.mapbox.map("map","http://a.tiles.mapbox.com/v3/examples.map-0l53fhk2.json",{zoom:15,center:[$lat,$long]});$.each(locations.response.groups[0].items,function(){var myIcon=L.icon({title:this.venue.name});console.log(myIcon.options.title),L.marker([this.venue.location.lat,this.venue.location.lng],{title:myIcon.options.title}).addTo(map)})}else console.log("Looks like foursquare is having issues, please try again later.")})}function error(position){console.log(position)}console.log("Button Pressed (1)"),navigator.geolocation?navigator.geolocation.getCurrentPosition(success,error):error("not supported")})});